<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Video/Image Shoot</title>
		<style type="text/css">
			.float-left {
				float: left;
			}
			.float-right {
				float: right;
			}
			video {
				height: 300px;
				width: 400px;
			}
			.btn-holder {
				width: 150px;
				height: 200px;
			}
			.btn-holder button {
				min-width: 140px;
			}
			canvas {
				border: 2px solid;
				margin: 2px;
			}
			#canvas-elm, #image-holder {
				margin-left: 150px;
			}
		</style>
	</head>
	<body>
		<div class="btn-holder float-left">
			<button id="load-btn">Load</button>
			<button id="play-btn">Play/Pause</button>
			<button id = "playRate-btn">playBackButton++</button>
			<button id = "subplayRate-btn">playBackButton--</button>
		</div>
		<video id="video-elm" controls>
			<source src="../videos/Bleach.mp4"></source>
			<!--<source src="http://media.w3.org/2010/05/sintel/trailer.mp4"></source>-->
			Your browser does not support HTML5 video.
		</video>
		<video id="video-elm-fast" style="left: 60%" controls>
			<!--<source src="../videos/Bleach.mp4"></source>-->
			<source src="http://media.w3.org/2010/05/sintel/trailer.mp4"></source>
			Your browser does not support HTML5 video.
		</video>
		<canvas id="canvas-elm"></canvas>
		<canvas id="canvas-fast" style="height: 300px; width: 400px;"></canvas>
		<div id ="image-holder"></div>
	</body>
	<script src="../../dsa-js-libs/event-handlers.js"></script>
	<script src="../js/video-manager.js"></script>
	<script src="../js/canvas-video-player.js"></script>
	<script src="../js/shoot.js"></script>
	<script type="text/javascript">
		var VideoControl,
			CanvasVideo,
			videoElm = document.getElementById('video-elm'),
			videoTime = 0;

		window.addEventListener('DOMContentLoaded', function(){
			init();
			attachEvents();
		});

		function init(){
			VideoControl = new VideoMngr(document, videoElm) || {};
			VideoControl.init();

			CanvasVideo = new CanvasPlayer(document, document.getElementById('video-elm'), document.getElementById('canvas-elm'));

			CanvasVideoFast = new CanvasPlayer(document, document.getElementById('video-elm-fast'),document.getElementById('canvas-fast'));
		}

		function attachEvents(){
			if(DSA && DSA.Events){
				DSA.Events.register(document.getElementById('load-btn'), "click",function(){
					VideoControl.load();
				},false);

				DSA.Events.register(document.getElementById('play-btn'), "click", function(){
					VideoControl.paused ? VideoControl.play() : VideoControl.pause();
				}, false);

				DSA.Events.register(document.getElementById('playRate-btn'), 'click', function(){
					VideoControl.addplaybackRate();
				}, false);

				DSA.Events.register(document.getElementById('subplayRate-btn'), 'click',function(){
					VideoControl.subplaybackRate();
				}, false);

				DSA.Events.register(document.getElementById('video-elm-fast'), 'timeupdate', function(e){
					var canvas = document.getElementById('canvas-fast'),
						context = canvas.getContext('2d');

					e.target.playbackRate = 2;

					draw(document.getElementById('video-elm-fast'), 50, 50);
					
					//document.getElementById('image-holder').appendChild(img);
					
				}, false);

			}
		}

		var $ = function $ (id) {
			return document.getElementById(id);
		}

		function draw(video, w, h){
			if(video.paused || video.ended)  return false;
			var lastBuffered = video.buffered.end(video.buffered.length-1);

			if(lastBuffered <= video.currentTime) return false


			var canvas = document.createElement('canvas'),
				context;

			canvas.height = 50;
			canvas.width = 50;
			context = canvas.getContext('2d');

			context.drawImage(video, 0, 0, w, h);
			document.getElementById('image-holder').appendChild(canvas);
			setTimeout(draw,100,video,w,h);				
		};

	</script>
</html>